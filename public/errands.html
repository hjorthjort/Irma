<!DOCTYPE html>
<html>
    <head>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
        <title>Irma: Friendly and fast tech support</title>

        <!-- CSS  -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link href="start/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
        <link href="start/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
        <meta charset="utf-8">
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="stylesheets/bootstrap_flatly.css">
        <!-- Import jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <link type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">

        <!-- Plugin CSS -->
        <link rel="stylesheet" href="stylesheets/animate.css" type="text/css">

        <script src="js/wow.min.js"></script>
        <script>
            new WOW().init();
        </script>
        <script src="js/creative.js"></script>

        <title>Irma: Friendly and fast tech support</title>
    </head>
    <body>

    <nav class="white" role="navigation">
        <div class="nav-wrapper container">
            <ul class="right hide-on-med-and-down">
                <li><a href="index.html"><i class="mdi-action-home"></i></a></li>
            </ul>

            <ul id="nav-mobile" class="side-nav">
                <li><a href="errands.html"><i class="mdi-action-home "></i></a></li>
            </ul>
            <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
        </div>
    </nav>

        <div id="index-banner" class="parallax-container">
            <div class="section no-pad-bot">
                <div class="container">
                    <br><br>
                    <div class="row center">
                        <img src="img/logo.png">
                        <h2 class="header col s12 light splash-header">Be a helper.</h2>
                    </div>
                    <div class="row center">
                        <div class="row">
                            <div class="col-lg-8 col-lg-offset-2">
                                <p class="jumbotron-text">Find people who need you. Heed the call. Get rewarded.</p>
                                <p class="jumbotron-text">Read about all open support request below. When you see one that you feel you can help with, click the button and you will get a phone number to call. You will be rewarded based on time spent and results.</p>
                                <p><a href="#errands_section" class="btn-flatly btn-flatly-primary btn-flatly-lg page-scroll" id="learnmore">Learn more</a></p>
                            </div>
                        </div>
                    </div>
                    <br><br>

                </div>
            </div>
            <div class="parallax"><img src="img/jumbotron.jpg" alt="Unsplashed background img 1"></div>
    </div>
        <section id="errands_section">
            <div class="container">
                <div id="errands_list" class="row">

                </div>
            </div>
        </section>
        <script>
            var errands = $.get("http://localhost:6001/errands", {}, function (errands, string, jqXHR) {
                console.info("Got stuff from db");
                console.info(errands);
                var errandOne = errands.rows[0];

                console.info(errandOne);
                addErrand(errandOne.doc.description, errandOne.doc._attachments["recording.wav"], errandOne.doc.tags, errandOne.doc.phone_number)

            });


            var description = "Lorem ipsum dolor sit amet, cu sit probo eirmod mnesarchum, at viris similique pri. Mei quaerendum theophrastus te. Duo ne ferri volumus adipisci. Te per meis solum alterum. Quo patrioque deterruisset an.";
            var soundfile = {content_type: "audio/wav", revpos: 2, digest: "md5-sPYAKuTEONMv8rwE9+yaLA==", length: 87724, stub: true}
            var tags = ['monitor', 'wifi', 'crying', 'super powers', 'explorer', 'arch linux' ];
            var phone = "0763 16 22 40"

            addErrand(description, soundfile, tags, phone);
            addErrand(description, soundfile, tags, phone);
            addErrand(description, soundfile, tags, phone);
            addErrand(description, soundfile, tags, phone);
            addErrand(description, soundfile, tags, phone);
            addErrand(description, soundfile, tags, phone);
            addErrand(description, soundfile, tags, phone);
            addErrand(description, soundfile, tags, phone);
            addErrand(description, soundfile, tags, phone);


            function addErrand(description, soundfile, tags, phone) {

                //Create table element, so we fit two cards on every row
                var newErrand = document.createElement("div");
                newErrand.classList.add("col-lg-6");

                //Create card
                var card = document.createElement("div");
                card.classList.add("row");

                var cardCols = document.createElement("div");
                cardCols.classList.add("card", "blue-grey", "darken-1");

                //Create content holder
                var cardContent = document.createElement("div");
                cardContent.classList.add("card-content", "white-text");

                //Create card heading
                var cardTitleDiv = document.createElement("div");
                cardTitleDiv.classList.add("row");
                var cardTitle = document.createElement("span");
                cardTitle.classList.add("card-title", "col-lg-12");
                cardTitle.innerHTML = "Task";
                cardTitleDiv.appendChild(cardTitle);

                var cardTagsDiv = document.createElement("div");
                cardTagsDiv.classList.add("row");
                var cardTags = document.createElement("div");
                cardTags.classList.add("col-lg-12");
                cardTagsDiv.appendChild(cardTags);

                //add all tags, comma separated
                tags.forEach(function (element, index, array) {
                    var chip = document.createElement("div");
                    chip.classList.add("chip");
                    chip.innerHTML = element;
                    cardTags.appendChild(chip);
                });

                var cardLeft = document.createElement("div");
                cardLeft.classList.add("col-lg-4");

                var cardImageDiv = document.createElement("div");
                cardImageDiv.classList.add("row")
                var cardImage = document.createElement("img");
                cardImage.classList.add("wow", "bounceIn", "col-lg-12", "text-center");
                cardImage.setAttribute("src", "http://lorempixel.com/250/250/people");
                cardImage.setAttribute("data-wow-delay", ".2s");
                cardImageDiv.appendChild(cardImage);

                var cardButtonDiv = document.createElement("div");
                cardButtonDiv.classList.add("row");
                var cardButton = document.createElement("a");

                cardButton.classList.add("btn-material", "waves-effect", "waves-light", "col-lg-12", "text-center");
                cardButton.innerHTML = "<i class='fa fa-phone fa-2x'></i>&nbsp;<span>I'll help!</span>";
                cardButton.onclick = function () {
                    cardButton.getElementsByTagName("span")[0].innerHTML = phone;
                    cardButton.classList.remove("btn-material");
                    cardButton.classList.add("btn-material");
                };
                cardButtonDiv.appendChild(cardButton);

                var cardRight = document.createElement("div");
                cardRight.classList.add("col-lg-8");

                // create description
                var cardDescriptionDiv = document.createElement("div");
                cardDescriptionDiv.classList.add("row");
                var cardDescription = document.createElement("p");
                cardDescription.classList.add("col-lg-12");
                cardDescription.innerHTML = description;
                cardDescriptionDiv.appendChild(cardDescription);

                // create soundfile
                var cardSoundfileDiv = document.createElement("div");
                cardSoundfileDiv.classList.add("row");
//                cardSoundfileDiv.innerHTML='<div class="videoPlayer"> <div class="play"><a href="javascript:void(0);">â–¶</a></div> <div class="progress"> <div class="loading"></div> <div class="playback"></div> </div> <div class="time">11:57</div> </div>';
                var cardSoundfile = document.createElement("audio");
                cardSoundfile.classList.add("col-lg-12", "text-center");
                //Display the audio with controls
                cardSoundfile.setAttribute("controls", "controls");
                var source = document.createElement("source");
                source.setAttribute("src", soundfile["digest"]);
                source.setAttribute("type", "audio/mpeg");
                source.setAttribute("preload", "metadata");
                console.info(soundfile);
                console.info(source);
                cardSoundfile.appendChild(source);
                cardSoundfileDiv.appendChild(cardSoundfile);


                //put the elements in each other
                cardLeft.appendChild(cardImageDiv);
                cardLeft.appendChild(cardButtonDiv);
                cardLeft.appendChild(cardSoundfileDiv);
                cardContent.appendChild(cardLeft);
                cardRight.appendChild(cardTitleDiv);
                cardRight.appendChild(cardDescriptionDiv);
                cardRight.appendChild(cardTagsDiv);
                cardContent.appendChild(cardRight);
                cardCols.appendChild(cardContent);
                card.appendChild(cardCols);
                newErrand.appendChild(card);
                $("#errands_list").append(newErrand);
            }
        </script>

    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="js/materialize.js"></script>
    <script src="js/init.js"></script>

    </body>
</html>
